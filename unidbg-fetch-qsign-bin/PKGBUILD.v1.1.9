# Maintainer: 5kind <shikabane320@gmail.com>

_pkgname=unidbg-fetch-qsign
pkgname=${_pkgname}-bin
_release=${_pkgname}.3.zip
pkgver=1.1.9
_qqver=8.9.63
pkgrel=1
arch=('any')
license=('GPL3')
_provide=qsign
provides=("$_provide")
depends=('java-environment>=8')
pkgdesc='获取QQSign参数通过Unidbg，开放HTTP API。'
backup=("opt/${_pkgname}/txlib/${_qqver}/config.json")
url='https://github.com/fuqiuluo/unidbg-fetch-qsign'
source=(
    "${srcdir}${_release}::${url}/releases/download/${pkgver}/${_release}"
    "${_provide}.service"
    "${_provide}@.service"
    )
sha256sums=(
    '936d04553b85cbd5876b533c8008cfe73b1db53ab7d70051931bdab8d96ad998'
    '0bfaff35e05059ba343faf039c39f7d3e0d5652f82266adf94db2868bfc6697d'
    'fe560a06ef6ba20210fbf37239974210ef8230bccd0506f1fa4601fb13b9ab85'
    )

package() {
  cd "${pkgdir}"
  mkdir -p "opt" "usr/lib/systemd/system"
  cp -r "${srcdir}/${_pkgname}-${pkgver}" "opt/${_pkgname}"

  mkdir -p "opt/${_pkgname}/txlib"
  cd "opt/${_pkgname}/txlib"
  ln -s "${_qqver}" "current"

  cd "${pkgdir}/usr/lib/systemd/system"
  install -Dm644 "${srcdir}/${_provide}.service" "${_provide}.service"
  install -Dm644 "${srcdir}/${_provide}@.service" "${_provide}@.service"
}
